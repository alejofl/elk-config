# Instalar ELK in Windows

Para poder obtener logs de Windows con ELK se incorpora a Winlogbeat, un componente que forma parte del stack de Elastic y facilita la manera en la que se realiza esta tarea.

Para cada componente que veremos a continuación estaremos trabajando en la carpeta `C:\program-version-number`.

> [!NOTE]  
> Para nuestra configuración en AWS solamente se necesitaron los apartados de **Instalando `winlogbeat`** e **Instalando `logstash`**. Los otros dos fueron realizados en instancias EC2 Ubuntu y por eso en este documento solamente se muestra la configuración de los mismos en el ambiente local.

## Instalando `elasticsearch`

1. Descargamos `elasticsearch` de la página:
    
    [Install Elasticsearch with .zip on Windows | Elasticsearch Guide [8.13] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/8.13/zip-windows.html)
    
2. Descomprimimos el archivo `.zip` que descargamos e ingresamos en la carpeta correspondiente. En nuestro caso ingresaremos a `C:\elasticsearch-8.13.4`.
3. Abirmos una terminal como administradores e ingresamos a la carpeta `C:\elasticsearch-8.13.4\bin`.
    
    ```bash
    >> cd bin
    ```
    
4. Corremos en la terminal el archivo `.\elasticsearch.bat` para poder instalarlo:
    
    ```bash
    >> .\elasticsearch.bat
    ```
    
5. Abrimos otra terminal también como administradores, ingresamos a la carpeta `C:\elasticsearch-8.13.4\bin` y corremos el siguiente comando:
    
    ```bash
    >> .\elasticsearch-users useradd johndoe -r superuser
    ```
    
    Esto crea un nuevo usuario y contraseña y es lo que nos permitirá ingresar a `kibana` más adelante con los siguientes datos:
    
    - User: `johndoe`
    - Password: `123456`

## Instalando `kibana`

1. Descargamos `kibana` de la página:
    
    [Install Kibana on Windows | Kibana Guide [8.13] | Elastic](https://www.elastic.co/guide/en/kibana/current/windows.html#windows-enroll)
    
2. Descomprimimos el archivo `.zip` que nos descargo y después ingresamos a la carpeta `C:\kibana-8.13.4`
3. Antes de continuar con `kibana` debemos ir a la carpeta donde se encuentra el archivo `elasticsearch-reset-password.bat` (en nuestro caso se encuentra en `C:\elasticsearch-8.13.4\bin\elasticsearch-reset-password.bat`) y abrimos una terminal como administrador para correr el siguiente comando:
    
    ```bash
    >> cd elasticsearch-8.13.4\bin
    >> .\elasticsearch-reset-password.bat -u kibana_system --auto
    warning: ignoring JAVA_HOME=C:\Users\nehue\.jdks\openjdk-20.0.2; using bundled JDK
    This tool will reset the password of the [kibana_system] user to an autogenerated value.
    The password will be printed in the console.
    Please confirm that you would like to continue [y/N]y
    
    Password for the [kibana_system] user successfully reset.
    New value: 6=ODDsGRMseRebDp1W2F
    ```
    
    Obtendremos la contraseña del usuario `kibana_system` que nos ayudará más adelante.
    
4. Ingresamos al archivo `kibana.yml`presente en la carpeta `C:\elasticsearch-8.13.4\config`. Una vez en él descomentaremos las líneas del `elasticsearch.username` y `elasticsearch.password`:
    
    ```bash
    # If your Elasticsearch is protected with basic authentication, these settings provide
    # the username and password that the Kibana server uses to perform maintenance on the Kibana
    # index at startup. Your Kibana users still need to authenticate with Elasticsearch, which
    # is proxied through the Kibana server.
    elasticsearch.username: "kibana_system"
    elasticsearch.password: "6=ODDsGRMseRebDp1W2F"
    ```
    
5. Abrimos una terminal como administradores y nos situamos en la carpeta de `kibana` (`C:\kiabana-8.13.4`) para correr el siguiente comando e instalar Kibana.
    
    ```bash
    >> .\bin\kibana.bat
    ```
    
6. Ingresamos a [localhost:5601](https://localhost:5601) e ingresamos con el siguiente usuario y contraseña para chequear que todo este correctamente instalado:
    - User: `johndoe`
    - Password: `123456`